// Generated by CoffeeScript undefined
watch(playback, 'state', function() {
  var ui, _ref;
  console.log(this);
  ui = $('#toggle_play');
  if ((_ref = this.state) === 'NOT_LOADED' || _ref === 'LOADING') {
    ui.attr('disabled', 'disabled');
  } else {
    ui.removeAttr('disabled');
  }
  switch (this.state) {
    case 'PLAYING':
      return ui.html('Pause');
    case 'DONE_PLAYING':
      return ui.html('Replay');
    default:
      return ui.html('Play');
  }
});

$('#traj_selection').on('change', function(event) {
  if ($(this).val() === '') {
    return;
  }
  playback.state = 'LOADING';
  playback.filename = 'trajectories/' + $(this).val();
  hubo.reset();
  c.render();
  return loadTrajectory(playback.filename, function(headers, data) {
    var i, id, _i, _j, _len, _ref;
    console.log(data.length);
    playback.data = data;
    playback.framerate = 200;
    headers[headers.indexOf('LKN')] = 'LKP';
    headers[headers.indexOf('RKN')] = 'RKP';
    headers[headers.indexOf('LEB')] = 'LEP';
    headers[headers.indexOf('REB')] = 'REP';
    for (i = _i = 0, _ref = data.length - 1; 0 <= _ref ? _i <= _ref : _i >= _ref; i = 0 <= _ref ? ++_i : --_i) {
      data[i][headers.indexOf('LSR')] += 20 / 180 * Math.PI;
      data[i][headers.indexOf('RSR')] -= 20 / 180 * Math.PI;
    }
    playback.working_headers = {};
    for (_j = 0, _len = headers.length; _j < _len; _j++) {
      id = headers[_j];
      if (hubo.motors[id] != null) {
        playback.working_headers[id] = headers.indexOf(id);
      }
    }
    playback.state = 'LOADED';
    playback.frame = 0;
  });
});

$('#toggle_play').on('click', togglePlay);

$('#load').on('click', function(event) {
  var callback, progress;
  $(this).html("Loading...").attr('disabled', 'disabled');
  window.c = new WebGLRobots.DefaultCanvas('#hubo_container');
  return window.hubo = new Hubo('hubo2', callback = function() {
    c.add(hubo);
    hubo.autorender = false;
    $('#panel_load').hide();
    return $('#panel_traj').show();
  }, progress = function(step, total, node) {
    return $('#load').html("Loading " + step + "/" + total);
  });
});

$(document).ready(function() {
  window.stats = new Stats();
  stats.setMode(0);
  $('#hubo_container').append(stats.domElement);
  stats.domElement.style.position = 'absolute';
  stats.domElement.style.left = '400px';
  return stats.domElement.style.top = '0px';
});
